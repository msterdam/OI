define("wkview:widget/kg_recommend/component/kgtree/kgtree.js",function(t,e){var i=t("wkview:widget/ui/html_view/widget.js"),s=i.widget,n=t("wkview:widget/kg_recommend/view/statistic.js").Statistic,h=t("wkcommon:widget/ui/lib/jquery/jquery.js"),o=(t("wkcommon:widget/lib/doT/doT.min.js"),t("wkcommon:widget/ui/js_core/log/log.js")),a=s({Options:{offsetLeftLevel2:48,offsetLeftLevel3:48,textNodePathoutOffset:15,textNodeHeight:32,levelOffsetHeight:8},elements:{},_init:function(){if(this.Mediator=this.options.Mediator,this.data=this.options.data,this.hasParent=this.data.parent?1:0,this.hasChildren=this.data.children&&this.data.children.length?1:0,this.childrenLength=0,this.data.children){var t=this.data.children.length;t=t>3?3:t,this.childrenLength=t}this.level=1+this.hasParent+this.hasChildren,this.cardType=this._initCardType(),this.textNodes="",this.paths="",this._initNodes()},_initEvents:function(){var t=this;t.on("onload",function(){t.tempTextNode=t.options.tempTextNode,t._calWithAndHeight()}),t.on("onload",function(){var e,i=t.$el.find(".text-wrap"),s=!1,n=0;t.bindEvent(i,"mouseenter",function(a){var r=h(a.currentTarget);if(r.hasClass("text-wrap")&&!r.hasClass("current")){var d=(new Date).getTime();s||(s=!0,e&&clearTimeout(e),e=setTimeout(function(){if(!(n-d>0&&50>n-d)){i.removeClass("current"),r.addClass("current");var s=r.attr("data-id"),h=r.attr("title"),a=r.attr("data-type");o.xsend(1,101199,{ent_uuid:s,type:a}),o.xsend(1,101225),t.Mediator.fire("s:getDoclistByChangeTreeNode",{entUuid:s,entName:h,pn:0}),e=null}},80))}}),t.bindEvent(i,"mouseleave",function(){s=!1,n=(new Date).getTime()})}),t.on("ondispose",function(){t.$el.html("")})},_render:function(){},_initCardType:function(){var t=-1;switch(this.level){case 3:t=3;break;case 2:t=1===this.hasParent?2:1;break;case 1:t=0}return t},_initNodes:function(){var t=this;this.nodes={cur:{ent_uuid:t.data.ent_uuid,ent_name:t.data.ent_name}},this.hasParent&&(this.nodes.parent=this.data.parent),this.hasChildren&&(this.nodes.children=this.data.children)},_calWithAndHeight:function(){this.containerWidth=this.$el.innerWidth(),this.containerHeight=this.$el.innerHeight(),this.contentWidth=this._calTreeWidth(),this.contentHeight=this._calTreeHeight(),this.contentOffsetLeft=(this.containerWidth-this.contentWidth)/2,this.contentOffsetTop=(this.containerHeight-this.contentHeight)/2,this.fire("ondispose"),this._drawTextNodes(),this._drawPaths()},_calTreeWidth:function(){var t=this,e=this.tempTextNode.text(this.nodes.cur.ent_name).parent(".text-wrap").outerWidth();t.nodes.cur.width=e;var i=0;this.hasParent&&(i=this.tempTextNode.text(this.nodes.parent.ent_name).parent(".text-wrap").outerWidth(),t.nodes.parent.width=e);var s=0;this.hasChildren&&h.each(t.nodes.children,function(e,i){var n=t.tempTextNode.text(i.ent_name).parent(".text-wrap").outerWidth();i.width=n,n>s&&(s=n)});var n=0;switch(this.cardType){case 1:n=Math.max(e,s+this.options.offsetLeftLevel2);break;case 2:n=Math.max(i,e+this.options.offsetLeftLevel2);break;case 3:n=Math.max(i,e+this.options.offsetLeftLevel2,s+this.options.offsetLeftLevel2+this.options.offsetLeftLevel3)}return n},_calTreeHeight:function(){var t=0;switch(this.cardType){case 1:t=this.options.textNodeHeight+this.options.levelOffsetHeight+this.options.textNodeHeight*this.childrenLength+this.options.levelOffsetHeight*(this.childrenLength-1);break;case 2:t=2*this.options.textNodeHeight+this.options.levelOffsetHeight;break;case 3:t=2*this.options.textNodeHeight+2*this.options.levelOffsetHeight+this.options.textNodeHeight*this.childrenLength+this.options.levelOffsetHeight*(this.childrenLength-1)}return t},_drawTextNodes:function(){var t=this;h.each(t.nodes,function(e,i){switch(e){case"parent":t._drawParentTextNode(i);break;case"cur":t._drawCurTextNode(i);break;case"children":t._drawChildrenTextNode(i)}}),this.$el.append(t.textNodes)},_drawParentTextNode:function(t){var e=t;e.type="parent",e.height=this.options.textNodeHeight,e.X=this.contentOffsetLeft,e.Y=this.contentOffsetTop,e.coords=this._setFiveCoords(e),this.textNodes+=this._createTextNodeStr(e)},_drawCurTextNode:function(t){var e=t;e.isCur=1,e.type="current",e.height=this.options.textNodeHeight,1===this.cardType?(e.X=this.contentOffsetLeft,e.Y=this.contentOffsetTop):(2===this.cardType||3===this.cardType)&&(e.X=this.contentOffsetLeft+this.options.offsetLeftLevel2,e.Y=this.contentOffsetTop+this.options.textNodeHeight+this.options.levelOffsetHeight),e.coords=this._setFiveCoords(e),this.textNodes+=this._createTextNodeStr(e)},_drawChildrenTextNode:function(t){var e=this,i=t,s=(i.length,this.contentOffsetLeft),n=this.contentOffsetTop;1===this.cardType?(s+=this.options.offsetLeftLevel2,n+=this.options.textNodeHeight+this.options.levelOffsetHeight):3===this.cardType&&(s+=this.options.offsetLeftLevel2+this.options.offsetLeftLevel3,n+=2*this.options.textNodeHeight+2*this.options.levelOffsetHeight),h.each(i,function(t,i){i.type="children",i.X=s,i.Y=n+(e.options.textNodeHeight+e.options.levelOffsetHeight)*t,i.height=e.options.textNodeHeight,i.coords=e._setFiveCoords(i),e.textNodes+=e._createTextNodeStr(i)})},_setFiveCoords:function(t){var e=[t.X+t.width/2,t.Y],i=[t.X+t.width-1,t.Y+t.height/2],s=[t.X+t.width/2,t.Y+t.height],n=[t.X+this.options.textNodePathoutOffset,t.Y+t.height],h=[t.X,t.Y+t.height/2];return{c0:e,c1:i,c2:s,c3:n,c4:h}},_createTextNodeStr:function(t){var e="";t.isCur&&1===t.isCur&&(e+="current");var i='<a class="text-wrap '+e+'" data-id="'+t.ent_uuid+'" data-type="'+t.type+'"  title="'+t.ent_name+'" style="left:'+t.X+"px; top:"+t.Y+'px;"><span class="text-node">'+t.ent_name+"</span></a>";return i},_drawPaths:function(){this.hasParent&&this._drawParentPath(),this.hasChildren&&this._drawCurPath(),this.$el.append(this.paths)},_drawParentPath:function(){var t=this.nodes.parent,e=this.nodes.cur;this.paths+=this._createPathStr(t,e,"border-left-bottom")},_drawCurPath:function(){var t=this.nodes.cur,e=this,i=e.nodes.children.length,s="border-bottom";h.each(e.nodes.children,function(n,h){n===i-1&&(s="border-left-bottom"),e.paths+=e._createPathStr(t,h,s)})},_createPathStr:function(t,e,i){var s=t.coords.c3[0],n=t.coords.c3[1],h=e.coords.c4[0]-s,o=e.coords.c4[1]-n,a='<div class="path '+i+'" style="left:'+s+"px; top:"+n+"px; width:"+h+"px; height:"+o+'px;"></div>';return a}},{type:"kgtree"});i.register(a,n,n.prototype),e.KGTree=a});