define("wkview:widget/html_view_newToolsbar/html_reader/js/newtoolsBar/pay.js",function(e,i,o){var t=(e("wkcommon:widget/ui/js_core/dialogCashier/dialogCashier.js"),e("wkcommon:widget/lib/tangram/base/base.js")),n=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,s=e("wkcommon:widget/ui/js_core/util/util.js"),a=e("wkview:widget/html_view/html_reader/js/toolsItem.js").toolsItem,c=(e("wkview:widget/html_view/html_reader/js/config.js").config,e("wkview:widget/html_view/html_reader/js/setting.js").setting,e("wkcommon:widget/ui/js_core/login/login.js").login),r=e("wkcommon:widget/lib/fis/data/data.js"),p=e("wkcommon:widget/ui/js_core/log/log.js"),d=e("wkcommon:widget/ui/lib/jquery/jquery.js"),l=e("wkcommon:widget/ui/lib/cookie/cookie.js"),u=n({Options:{position:"centerRight",reader:{}},_init:function(){var e=this,i=r.get("WkInfo").DocInfo,o=((i.payPrice||0)/100).toFixed(2),n=((i.vip_price||0)/100).toFixed(2),a=(i.vip_type,i.goodsPayStatus),u=((i.confirm_price||o)/100).toFixed(2),v="PCActivity"==a.split("_")[0],_=i.is_only_vip_doc,g=1==i.org_discount_status,y='<span class="original-price">\uffe5'+o+"&nbsp;</span>",b=Math.round(i.org_discount_price/i.payPrice*10),w=(r.get("WkInfo").DocInfo.docId,r.get("WkInfo").DocInfo.is_discount_doc);if(g){var f=(i.org_discount_price/100).toFixed(2);y+='<br/><span class="vip-free">'+b+"\u6298\u4ef7:\uffe5"+f+"</span>"}else v?(y='<i class="zhe-price-icon"></i><span class="vip-free activity-price">\uffe5'+u+'</span><span class="real-price">\uffe5'+o+"&nbsp;</span>",setTimeout(function(){i.vip_type>0||i.edu_vip_type>0||i.jiaoyu_vip_type>0},2e3)):(y=(i.vip_type>0||i.edu_vip_type>0||i.jiaoyu_vip_type>0)&&i.is_discount_doc?'<i class="zhe-price-icon"></i><span class="vip-free activity-price">\uffe5'+(i.vip_price/100).toFixed(2)+'</span><span class="real-price">\uffe5'+o+"&nbsp;</span>":'<span class="price price-new">\uffe5'+o+"</span>",i.is_only_vip_doc&&(y='<span class="vip-free">\u6587\u5e93VIP\u514d\u8d39\u9605\u8bfb</span>'));var h="";if(void 0!==i.wk2yd&&0!==+i.wk2yd)return h='<div class="reader-tools-btn-wrap-new"><a href="http://yuedu.baidu.com/ebook/'+i.wk2yd+'?fr=wenku" class="ui-bz-btn reader-pay'+(_?" reader-pay-disable":"")+'" alog-action="reader.buy.doc"><b class="ui-btn-p-10 ui-btn-btc">\u8d2d\u4e70</b></a><span class="vip-free-buy'+(_?" only_vip_doc":"")+'">'+y+"</span></div>",void(e.el=s.createDom(h));if(h='<div class="reader-tools-btn-wrap-new"><a href="###" class="ui-bz-btn-senior reader-pay'+(_?" reader-pay-disable":"")+'" alog-action="reader.buy.doc"><span class="vip-free-buy'+(_?" only_vip_doc":"")+'">'+y+'</span><b class="ui-btn-p-16 ui-btn-btc">\u8d2d\u4e70\u672c\u6587</b></a><a class="ui-bz-btn pack-pay org-pay-hide ml5" data-toolsbar-log="paybutton"href="###" alog-action="htmltoolbar.buy"><b class="ui-btn-p-16 ui-btn-btc"><i>\u52a0\u5165VIP</i><br>\u672c\u6587\u514d\u8d39\u8d60\u9001</b></a><a class="ui-bz-btn add-vip-discount ml5" style="display:none" href="javascript:;"><b class="ui-btn-p-16"><i>\u52a0\u5165VIP</i><br>8\u6298\u8d2d\u4e70\u672c\u6587</b></a><a class="ui-bz-btn add-vip-chance ml5" style="display:none" href="javascript:;"><b class="ui-btn-p-16"><i>\u52a0\u5165VIP</i><br>\u83b7\u53d6\u66f4\u591a\u7279\u6743</b></a><span class="eight-discount">VIP\u4ef7\u683c\uff1a\uffe5'+n+"</span></div>",e.el=s.createDom(h),0===+i.org_discount_status){var m='<div id="org-discount-tip"><span class="close-icon"></span><span class="arrow-icon"></span><span class="tip-text">\u4eca\u5929\u8d2d\u4e70'+i.org_title+"\u6587\u6863\uff0c\u7b2c2\u7bc7\u8d77\u4eab"+b+"\u6298\u4f18\u60e0</span></div>";d(e.el).append(m)}else if(1===+i.org_discount_status){var k='<div id="org-discount-tip" class="now-discount"><span class="close-icon"></span><span class="arrow-icon"></span><span class="tip-text">\u672c\u6b21\u8d2d\u4e70\uff0c\u4eab\u53d7'+b+"\u6298\u54e6\uff01</span></div>";d(e.el).append(k)}l.get("org_discount_pop_close")||d(e.el).find("#org-discount-tip").show(),e.clickEl=t.dom.q("reader-pay",e.el,"a")[0],e.pack_clickEl=t.dom.q("pack-pay",e.el,"a")[0],e.bindEvent();+r.get("isDialogCashier");d(e.el).on("click",".add-vip-discount",function(){p.xsend(1,101492),c.verlogin(function(){window.location.href="/cashier/browse/dispatch?dqStatCode=31_8_9_73"})}),d(e.el).on("click",".add-buy-report",function(){var e=r.get("WkInfo").DocInfo.docId,i=+r.get("WkInfo").PageInfo.isLogin;i?window.location.href="/org/browse/report?fr=btn&cashier_code=buy_report_doc&id="+e:c.verlogin(function(){})}),d(e.el).on("click",".add-vip-chance",function(){d(this).hasClass("add-buy-report")||(p.xsend(1,101492),c.verlogin(function(){window.location.href="/cashier/browse/dispatch?dqStatCode=31_8_9_73"}))}),setTimeout(function(){if(1==i.hangyebaogao_customized){var e=((+i.confirm_price||0)/100).toFixed(2),s='<span style="color: #888; margin-right: 20px;">\uffe5'+e+"</span>";d(".add-vip-chance").addClass("add-buy-report").find("b").html("\u5f00\u59cb\u5b9a\u5236"),d(".add-vip-chance").show(),d(".reader-pay").hide(),d(".vip-free-buy").html(s)}else o&&5>=o&&(!i.vip_type||0==i.vip_type)&&0==i.edu_vip_type&&0==i.jiaoyu_vip_type&&t.lang.eventCenter.dispatchEvent("pack.button.hide"),i.vip_type&&0!==i.vip_type||0!==i.edu_vip_type||0!==i.jiaoyu_vip_type||(o&&o>5&&n!==o&&1===w&&d(".add-vip-discount").show(),o&&o>5&&n===o&&d(".add-vip-chance").show(),v&&o&&o>5&&(d(".pack-pay").length&&d(".pack-pay").hide(),d(".add-vip-chance").show()))},300)},getFinalPrice:function(){var e=r.get("WkInfo").DocInfo,i=e.payPrice||0,o=e.goodsPayStatus,t=e.confirm_price||i,n="PCActivity"===o.split("_")[0],s=1===+e.org_discount_status,a=i;return s?a=e.org_discount_price:n?a=t:(a=(e.vip_type>0||e.edu_vip_type>0||e.jiaoyu_vip_type>0)&&e.is_discount_doc?e.vip_price:i,e.is_only_vip_doc&&(a=0)),a},bindEvent:function(){var e=this,i=r.get("WkInfo").DocInfo;t.event.on(e.clickEl,"click",function(o){o=o||window.event,t.event.preventDefault(o);var n=t.event.getTarget(o);t.lang.eventCenter.addEventListener("Login.Success",function(e){t.event.stop(e),t.lang.eventCenter.dispatchEvent("ReaderToolsBar.BuyDoc",{target:n})});var s=i.payPrice||0,a=e.getFinalPrice(),d=i.docId,l=d,u=r.get("WkInfo").PageInfo.isLogin;u||p.xsend(1,100351),c.verlogin(function(){p.xsend(1,100351),p.xsend(1,101316,{originPrice:s,salePrice:a,docId:d,goodsId:l,type:1}),t.lang.eventCenter.dispatchEvent("ReaderToolsBar.BuyDoc",{target:n})},null,null,null,!1)}),t.event.on(e.pack_clickEl,"click",function(e){e=e||window.event,t.event.preventDefault(e);t.event.getTarget(e);p.xsend(1,101492);var o='/cashier/browse/vipwithdoccashier?doc_ids=["'+i.docId+'"]&dqStatCode=31_35_37';window.location.href=o}),d("body").on("click","#org-discount-tip .close-icon",function(){d("#org-discount-tip").hide();var e=new Date;e.setHours(23),e.setMinutes(59),e.setSeconds(59),l.set("org_discount_pop_close","1",{expires:e})})}},{superClass:a});o.exports.pay=u});