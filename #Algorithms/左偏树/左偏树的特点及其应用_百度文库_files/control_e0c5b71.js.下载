define("wkview:widget/ui/html_view/slider/control.js",function(e,t,o){var n=e("wkview:widget/ui/html_view/widget.js").widget,s=e("wkview:widget/ui/html_view/dep/object/object.js"),i=e("wkview:widget/ui/html_view/dep/page/page.js"),r=e("wkview:widget/ui/html_view/dep/drag/drag.js").drag,a=e("wkcommon:widget/lib/tangram/base/base.js"),c=n({Options:{accuracy:0,orientation:"vertical",direction:"backward"},elements:{"@view":"$view","@start-corner":"$startCorner","@last-corner":"$lastCorner","@inner":"$inner","@process":"$process","@knob":"$knob","@thumbs":"$thumbs","@thumbs-content":"$thumbsContent","@arrow-left":"$arrowLeft","@arrow-right":"$arrowRight","@toolbar-ipt":"$toolbarIpt"},events:{"$view click,mousedown":"_eventControl","$knob mousedown":"thumbsShow","$arrowRight click":"next","$arrowLeft click":"prev","$toolbarIpt blur":"blur","$toolbarIpt keyup":"keyup","$toolbarIpt keydown":"keydown"},_init:function(){var e=this,t=e.options._isVertical="vertical"===e.options.orientation;e.options.freeValue=((e.options.freeNum-1)/e.options.countPn).toFixed(4),"backward"===e.options.direction&&(e.options._oppsite=!0),s.extend(e.options,{_suffix:t?"vtl":"htl",_knobKey:t?"top":"left",_mouseKey:t?"y":"x",_accuracyKey:t?"height":"width"})},next:function(){this.fire("nextbtn")},prev:function(){this.fire("prevbtn")},blur:function(){var e=this.$elements.$toolbarIpt.val();e!==this.curPn&&this.$elements.$toolbarIpt.val(this.curPn)},keyup:function(e){var t=this,o=t.$elements.$toolbarIpt.val();if(13===e.keyCode&&~~o>0&&~~o<=t.options.countPn){o=~~o>t.options.freeNum?t.options.freeNum:~~o,t.setCurPage(o),t.fire("gotopage"),t.fire("closeTrade");var n=((o-1)/t.options.countPn).toFixed(4);t.setValue(n),t.fire("onchange",{value:n})}},keydown:function(e){{var t=this;t.$elements.$toolbarIpt.val()}(e.keyCode<48||e.keyCode>57)&&13!==e.keyCode&&8!==e.keyCode&&e.preventDefault()},_initEvents:function(){var e=this;e.on("onload",function(){var t=e.$elements.$view,o=e.$elements.$inner,n=e.options._accuracyKey;e.options._val="offset"+n.replace(/([a-z])([a-z]*)/,function(e,t,o){return t.toUpperCase()+o}),e.options.width=t.width(),e.options.height=t.height(),e.options._range=[0,e.options[n]],e.options._limit=o[0][e.options._val],e.options._const=(e.options._range[1]-e.options._limit)/2,e._setAccuracy(e.options.accuracy),e.setValue(e.options.currentValue),e.setRange(e.options.freeValue),a.lang.eventCenter.addEventListener("input.keyupnew",function(t){var o=t.e,n=t.currentval;if(13===o.keyCode&&~~n>0&&~~n<=e.options.countPn){n=~~n>e.options.freeNum?e.options.freeNum:~~n,e.setCurPage(n),e.fire("gotopage"),e.fire("closeTrade");var s=((n-1)/e.options.countPn).toFixed(4);e.setValue(s),e.fire("onchange",{value:s})}})});var t=!0;e.on("change",function(){if(t)return t=!1,!1;e.thumbsShow();var o=e.$elements.$knob.css("left");e.$elements.$thumbs.css("left",o)}),e.on("onslidestop",function(){e.thumbsHide()})},setValue:function(e){var t=this;if(t.curPn>t.options.freeNum)return e=t.options.freeValue,t.fire("goToTrade"),!1;t.curPn===t.options.countPn&&(e=1);var o=t.options._accuracyKey;e=e||0;var n=t.options[o]*e;t.options._oppsite&&(n=t.options[o]*t._accSub(1,e)),t._setPosition({target:null,noAccuracy:!0,noFx:!0},n),t.options.currentValue=e},getValue:function(){return this.options.currentValue},setRange:function(e){var t=this,o=t.options[t.options._accuracyKey],n=e*o;if(!t.options.accuracy){t.options._oppsite?t.options._range[0]=n:t.options._range[1]=n,t.options._percent=n/o;var s=t.$elements.$knob;t.options.maxRange=t.options._range[1]+s[0][t.options._val]}},_accSub:function(e,t){var o,n,s,i;try{o=e.toString().split(".")[1].length}catch(r){o=0}try{n=t.toString().split(".")[1].length}catch(r){n=0}return s=Math.pow(10,Math.max(o,n)),i=o>=n?o:n,+((e*s-t*s)/s).toFixed(i)},_startDrag:function(e){var t=this,o=t.$elements.$knob,n=t.$elements.$process,s=t.options.accuracy,i=t.options.width,a=t.options.height,c=0,p=0,u=o[0][t.options._val],l=t.options._range,_=[],f=parseInt(o.css("margin-"+t.options._knobKey),10);e.stopPropagation(),t.options._isVertical?(a=l[1]+u,c=l[0]):(i=l[1]+u,p=l[0]),_=[c,i,a,p],e.target!==o[0]||t._isMoving||(t._recover(),r(o[0],{range:_,fix:[t.options._knobKey,f],ondragstart:function(){t.fire("onslidestart")},ondrag:function(){var e=t._getRealPos(o,t.options._knobKey),s=t._getProcessPos(e);n.css(t.options._accuracyKey,s),t._setCurrentValue(e),t.options.currentValue>t.options.freeValue&&(t.options.currentValue=t.options.freeValue),t.fire("onslide"),t.fire("onchange",{value:t.options.currentValue,offset:s}),t.fire("closeTrade")},ondragend:function(e,o,n){n=n[t.options._knobKey],t._reset(n),s&&t._useAdsorbr(n),t.fire("gotopage")}}))},_resize:function(){var e,t=this,o=isNaN(Math.min(t.options._percent,1))?1:Math.min(t.options._percent,1),n=t.$elements.$inner,s=t.$elements.$view;t.options.width=s.width(),t.options.height=s.height(),t.options._limit=n[0][t.options._val],e=t.options[t.options._accuracyKey],t.options._range=t.options._oppsite?1>o?[e*o,e]:[0,e]:[0,e*o],t._setAccuracy(t.options.accuracy)},_recover:function(){var e=this,t=e.$elements.$knob,o=e.$elements.$process,n=e.options._accuracyKey,s=t[0].style[e.options._knobKey],i=o[0].style[n];/px|auto/.test(s)||(s.length||(s=0),i.length||(i=0),s=parseFloat(s)/100*e.options[n]+"px",i=parseFloat(i)/100*e.options._limit+"px",t.css(e.options._knobKey,s),o.css(n,i))},_reset:function(e){var t=this,o=t.$elements.$knob,n=t.$elements.$process;/%/.test(e)||(o.css(t.options._knobKey,t._knobPercent(e)),n.css(t.options._accuracyKey,t._processPercent(t._getProcessPos(e))))},_knobPercent:function(e){return parseFloat(e)/this.options[this.options._accuracyKey]*100+"%"},_processPercent:function(e){return 0===this.options._limit?"0":parseFloat(e)/this.options._limit*100+"%"},_getRealPos:function(e,t){return e[0].style[t]},_getProcessPos:function(e){var t=this,o=t.options._range,n=t.options._limit;if(e=parseFloat(e)-t.options._const,o[0]&&e<o[0]){var s=o[0]-t.options._const;return s>0?s+"px":0}return e>o[1]?o[1]-t.options._const+"px":(0>e&&(e=0),e>n&&(e=n),t.options._oppsite&&(e=n-e),e+"px")},_getKnobPos:function(e){var t=this;e=parseFloat(e);var o=t.options._range;return e=t.options._oppsite?e<o[0]?o[0]:e:e>o[1]?o[1]:e,e+"px"},_getMousePos:function(){var e=this.$elements.$view,t=i.getMousePosition(),o=e.offset();return"x"===this.options._mouseKey?t.x-o.left:t.y-o.top},_move:function(e,t,o){var n=this,s=(n.options._range,n._getKnobPos(o)),i=n._getProcessPos(o),r=n.$elements.$knob,a=n.$elements.$process;n._setCurrentValue(s),r.css(n.options._knobKey,n._knobPercent(s)),a.css(n.options._accuracyKey,n._processPercent(i))},_setCurrentValue:function(e){var t=this,o=10*parseFloat(e)/(10*t.options[t.options._accuracyKey]);t.options._oppsite&&(o=t._accSub(1,o)),t.options.currentValue=o},_slide:function(e,t){var o=this,n=o.$elements.$knob,s=o.$elements.$process;o.fire("startFx",{knob:n,process:s,pos:e,fn:t})&&(o._move(n,s,e),t&&t())},_setPosition:function(e,t){var o=this,n=o.$elements.$knob,s=e.noAccuracy||!o.options.accuracy,i=function(){o._isMoving=!1,o.fire("onchange",{value:o.options.currentValue})};void 0===t&&(t=o._getMousePos()),e.target!==n[0]&&(o._isMoving=!0,s?o._slide(t,i,e.noFx):o._useAdsorbr(t,i,e.noFx))},_useAdsorbr:function(e,t,o){var n=this;e=parseFloat(e)||0;var s,i=n.options._range,r=n.options._accuracyZone.slice(0),a=r.length,c=0,p=e;if(0===e||e>i[1])s=e;else if(n.options.accuracy)for(;a>c;c++){var u=Math.abs(r[c]-e);p>=u&&(p=u,s=r[c])}else s=e;n._slide(s,t,o)},_setAccuracy:function(e){var t,o=this,n=o.options._range,s=o.options._accuracyKey,i=e*o.options[s],r=0,a=[0];for(0===e&&(o.options.accuracy=0,delete o.options._accuracyZone),o.options.accuracy=e;(t=r+i)&&t<n[1];)r=t,a.push(t);o.options._accuracyZone=a.concat(o.options[s])},_eventControl:function(e){var t=this,o=t.$elements.$knob;if(e.preventDefault(),t._resize(),t.getStatus())if(e.target===o[0]&&"mousedown"===e.type)t._startDrag(e);else if("mousedown"===e.type&&t.fire("onbeforeslideclick")){this.fire("closeTrade");var n=t._getMousePos();n<=t.options.maxRange?(t._setPosition(e),t.fire("gotopage"),t.fire("onslideclick")):(t.setCurPage(t.options.freeNum),t.fire("gotopage"),t.setValue(t.options.freeValue),t.fire("onchange",{value:t.options.freeValue}))}},setCurPage:function(e){this.curPn=e},getCurPage:function(){return this.curPn},setIpt:function(e){this.$elements.$toolbarIpt.val(e)},setThumbs:function(e){this.$elements.$thumbsContent.html(e)},thumbsHide:function(){this.$elements.$thumbs.hide()},thumbsShow:function(){this.$elements.$thumbs.show()},setCountPn:function(e){this.options.countPn=e}},{type:"Slider_Control"});o.exports.Control=c});