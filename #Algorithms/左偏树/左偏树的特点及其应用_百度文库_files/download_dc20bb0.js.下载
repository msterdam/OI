define("wkview:widget/html_view_newToolsbar/html_reader/js/newtoolsBar/download.js",function(e,o,i){var n=(e("wkcommon:widget/ui/js_core/dialogCashier/dialogCashier.js"),e("wkcommon:widget/lib/tangram/base/base.js")),t=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,a=e("wkcommon:widget/ui/js_core/util/util.js"),s=e("wkcommon:widget/ui/js_core/log/log.js"),d=e("wkview:widget/html_view/html_reader/js/toolsItem.js").toolsItem,l=(e("wkview:widget/html_view/html_reader/js/config.js").config,e("wkview:widget/html_view/html_reader/js/setting.js").setting,e("wkview:widget/ui/view/down_doc/down_doc.js").downDocCreate,e("wkview:widget/doc_download_main/doc_download_main.js")),c=e("wkcommon:widget/ui/js_core/login/login.js").login,r=e("wkcommon:widget/lib/fis/data/data.js"),p=e("wkcommon:widget/ui/js_core/_dialog/_dialog.js").alert,w=t({Options:{position:"centerRight",reader:{}},_init:function(){var e=this,o=r.get("WkInfo").DocInfo,i=(o.price||0,o.docTicket||0),t=o.isPaymentDoc||0,d=o.isInRoomButDeletedByCreater||!1,l=t?"\u5df2\u8d2d\u4e70":i+"&nbsp;\u4e0b\u8f7d\u5238",p=o.isdownloaded||0,w=t&&!p||d?" downloadDisabled":"",g=document.getElementById("edit-docPrice"),m=+o.isPaymentDoc||0,_=+o.ispaied||0,f=+o.hangyebaogao_customized||0;o.vip_free_buy&&(l=['<span class="vip-free-buy">','<span class="original-price">\uffe5'+(o.payPrice/100).toFixed(2)+"</span><br/>",'<span class="vip-free">VIP\u514d\u8d39\u9605\u8bfb</span>',"</span>"].join(""),o.is_only_vip_doc&&(l=['<span class="vip-free-buy only_vip_doc">','<span class="vip-free">VIP\u514d\u8d39\u9605\u8bfb</span>',"</span>"].join("")));var v;v=1==r.get("WkInfo").DocInfo.freeDoc?['<div class="reader-tools-btn-wrap" style="position:relative;"><a class="ic reader-download" href="###" data-toolsBar-log="download" alog-action="htmltoolbar.download"><span style="display: block;position: absolute;top: -5px;right: 0px;width: 66px;font-size: 13px;height: 37px;line-height: 37px;padding-left: 18px;background: url(https://edu-wenku.bdimg.com/icms_transform/img/iknow/wenku/free-doc_02.gif) no-repeat 0 -2px;" class=""><span style="text-decoration: line-through;color:#999">'+r.get("WkInfo").DocInfo.freeMoney+'.00&nbsp;</span><span style="color:#e87301;">\u514d\u8d39</span></span></a></div>'].join(""):'<div class="reader-tools-btn-wrap-new download-btn"><a class="reader-download ui-bz-btn-senior'+w+'" href="###" data-toolsBar-log="download" alog-action="htmltoolbar.download"><b class="ui-btn-btc"><i>'+l+'</i></br>\u7acb\u5373\u4e0b\u8f7d</b></a><a href="javascript:void(0)" id="tip-notice-new" style="display:none" class="vip-free-auto"><i>\u52a0\u5165VIP</i></br>\u514d\u5238\u4e0b\u8f7d\u672c\u6587</a></div>',e.el=a.createDom(v);{var h=r.get("WkInfo").PageInfo.isLogin,u=r.get("WkInfo").DocInfo.docId,k=$(e.el).find("#tip-notice-new");r.get("WkInfo")}if(h){var b="/cashier/browse/dispatch?doc_id="+u;("\u52a0\u5165VIP\u514d\u5238\u4e0b\u8f7d\u672c\u6587"===k.text()||"\u52a0\u5165VIP\u83b7\u53d6\u66f4\u591a\u7279\u6743"===k.text())&&k.attr("href",b+"&dqStatCode=31_8_171_172"),"VIP\u4e13\u4eab\u514d\u8d39\u4e0b\u8f7d"===k.text()&&k.attr("href",b+"&dqStatCode=31_8_171_174")}if($("body").on("click","#tip-notice-new",function(){var e=k.text();h?(s.xsend(1,100526),"\u52a0\u5165VIP\u514d\u5238\u4e0b\u8f7d\u672c\u6587"===e||"\u52a0\u5165VIP\u83b7\u53d6\u66f4\u591a\u7279\u6743"===e?(s.xsend(1,100459),s.xsend(1,101492)):"VIP\u4e13\u4eab\u514d\u8d39\u4e0b\u8f7d"===e&&(s.xsend(1,100461),s.xsend(1,101492))):"\u52a0\u5165VIP\u514d\u5238\u4e0b\u8f7d\u672c\u6587"===e||"\u52a0\u5165VIP\u83b7\u53d6\u66f4\u591a\u7279\u6743"===e?(s.xsend(1,100459),s.xsend(1,101492),c.verlogin(function(){s.xsend(1,100526),window.location.href="/cashier/browse/dispatch?doc_id="+u+"&dqStatCode=31_8_171_172"},null,null,{actionName:"cashier",fromMod:"cashier"})):k.hasClass("vip-enjoy")&&(s.xsend(1,100461),s.xsend(1,101492),c.verlogin(function(){s.xsend(1,100526),window.location.href="/cashier/browse/dispatch?doc_id="+u+"&dqStatCode=31_8_171_174"},null,null,{actionName:"cashier",fromMod:"cashier"}))}),o.isPaymentDoc||!(i>0)||o.vip_type||o.edu_vip_type||o.jiaoyu_vip_type||k.css("display","inline-block"),_&&f&&m){var k=$("#tip-notice-new");k.css({visibility:"hidden",display:"none"})}g&&(t||e.el.appendChild(g),n.string.trim(g.innerHTML)&&(g.style.display="")),e.clickEl=n.dom.q("reader-download",e.el,"a")[0],e.bindEvent()},bindEvent:function(){var e=this,o=r.get("WkInfo").DocInfo,i=o.isInRoomButDeletedByCreater?"\u6743\u9650\u95ee\u9898":"\u7248\u6743\u65b9\u8981\u6c42",t=r.get("WkInfo");n.event.on(e.clickEl,"click",function(o){if(n.event.preventDefault(o),e.isFromViewRec()){var a=t.DocInfo||{},d=a.docTicket,c=function(){var e=!!r.get("VipFreeDoc");return e?0:a.docTicket}(),w=a.docId;s.xsend(1,101316,{originPrice:d,salePrice:c,docId:w,type:2})}s.xsend(1,100035),n.lang.eventCenter.dispatchEvent("smallFlowDownBtn"),n.dom.hasClass(e.clickEl,"downloadDisabled")?p({title:"\u63d0\u793a",content:'<p style="font-size:14px;margin:20px;text-align:center;">\u8be5\u6587\u6863\u56e0'+i+"\uff0c\u4ec5\u652f\u6301\u5728\u7ebf\u9605\u8bfb\u54e6\u3002</p>",width:350,height:180}):l.goSpecialDownload(t)}),"inline-block"===$(".vip-free-auto").css("display")&&(s.xsend(1,101491),e.jionvip=n.dom.q("vip-free-auto",e.el,"a")[0],n.event.on(e.clickEl,"click",function(){s.xsend(1,101492)}))},isFromViewRec:function(){return/mark_pay_doc/.test(location.search)&&/mark_rec_page/.test(location.search)&&/mark_rec_position/.test(location.search)?!0:!1}},{superClass:d});i.exports.download=w});