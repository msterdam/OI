define("wkview:widget/html_view_newToolsbar/html_reader/js/newtoolsBar/toolsBar.js",function(e,t,i){function o(e,t,i,o){i=i||1;var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),o=o&&";path="+o,document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()+o}function r(e){for(var t=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var r=i[o];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf(t))return r.substring(t.length,r.length)}return""}var s=e("wkcommon:widget/lib/tangram/base/base.js"),n=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,a=e("wkcommon:widget/ui/js_core/util/util.js"),d=e("wkview:widget/html_view/html_reader/js/config.js").config,l=e("wkview:widget/html_view/html_reader/js/setting.js").setting,c=e("wkcommon:widget/lib/fis/data/data.js"),h=c.get("WkInfo"),f=s.dom,v=f.q,g=!1,m=!0,p=!1,w=e("wkcommon:widget/ui/js_core/log/log.js"),u=n({Options:{readerContainer:{},reader:{},items:[]},_init:function(){var e=this,t=c.get("isHitVipDocLimited");e.template=['<div class="reader-tools-bar-wrap ugctest tools-bar-small">','<div class="reader-tools-bar">','<div class="reader-tools-bar-center clearfix">','<div class="left"></div>',h.DocInfo.isPaymentDoc&&h.DocInfo.ispaied&&0===~~h.DocInfo.isPayDocAndCommented&&!r("closeComment")?'<span id="add-comment-tips" class="add-comment-tips"><span class="comment-tips-close"></span></span>':'<span id="share-tips" class="fenxiang"><span class="close fenxiang"></span></span>','<div class="center"><div class="centerLeft"></div><div class="centerRight"></div></div>','<div class="right"></div>',"</div>","</div>","</div>"].join(""),e.wrapEl=a.createDom(e.template),e.bodyEl=s.dom.query(d.bodySelector)[0],e.asideEl=s.dom.query(d.aside)[0],e.asideWidth=e.asideEl.offsetWidth+34,e.el=v("reader-tools-bar",e.wrapEl,"div")[0],e.left=v("left",e.el,"div")[0],e.right=v("right",e.el,"div")[0],e.center=v("center",e.el,"div")[0],e.centerRight=v("centerRight",e.el,"div")[0],e.close=f.q("fenxiang",e.el,"span")[1],e.commentClose=f.q("comment-tips-close",e.el,"span")[0],e.toolsDocBottom=!1,e.items.length&&e._initItem(),h.DocInfo.isApi||document.body.appendChild(e.wrapEl),e.fire("onload"),e.bindEvent(),t&&$(".reader-tools-bar").find(".right").addClass("right-vip-auto")},_initItem:function(){var e=0,t=this,i=t.items,o=i.length;for(t.list=[],o;o>e;e++)t.addItem(i[e])},bindEvent:function(){var e=this,t=$(".reader-tools-bar").find(".reader-back2top-wrap");e.on("itemChange",function(t,i){var o=i.target,r=0,s=e.list,n=s.length;for(n;n>r;r++)o!==s[r]&&(s[r].status="disabled")}),$(window).on("scroll",function(){var e=$(window).scrollTop();200>e?t.css("display","none"):("none"===t.css("display")&&w.xsend(1,101018,{index:1001}),t.css("display","block"))}),s.event.on(e.close,"click",function(){$(this).parent().hide()}),s.event.on(e.commentClose,"click",function(){o("closeComment","1"),$(this).parent().hide()}),s.event.on(e.wrapEl,"mouseleave",function(){e.resizeRight()}),s.event.on(e.el,"click",function(e){var t=s.event.getTarget(e);itemAttr=s.dom.getAttr(t,"data-toolsBar-log"),itemAttr&&s.lang.eventCenter.dispatchEvent("ReaderToolsBar.itemClick",{name:itemAttr,el:t,setting:l})}),s.lang.eventCenter.addEventListener("InFullScreen.after",s.fn.bind(e.resizeFullScreen,e)),s.lang.eventCenter.addEventListener("OutFullScreen.after",s.fn.bind(e.resize,e)),s.lang.eventCenter.addEventListener("Reader.fullScreenResize",s.fn.bind(e.resizeFullScreen,e)),s.lang.eventCenter.addEventListener("xreaderResizeRight",s.fn.bind(e.resizeRight,e)),s.event.on(window,"scroll",function(){s.lang.eventCenter.dispatchEvent("window.scroll")}),s.lang.eventCenter.addEventListener("window.scroll",s.fn.bind(e.resizeLocation,e))},addItem:function(e){if(s.lang.isFunction(e)){var t=this,i=new e({readerContainer:t.readerContainer,toolsBar:t,reader:t.reader,status:"disabled"}),o=i.position,r=v(o,t.el,"div")[0];i.el&&r.appendChild(i.el),t.list.push(i)}},resizeFullScreen:function(){var e=this;e.toolsDocBottom&&($(".reader-tools-bar-wrap").appendTo($("body")),$(".reader-tools-bar-wrap").css("position","fixed")),e.el.style.width="100%",e.el.offsetWidth<860&&(e.el.style.width="860px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0}),e.toolsDocBottom=!1,e.resizeCenter(),e.resizeRight()},resizeCenter:function(){var e=this,t=e.center,i=e.el.offsetWidth-e.asideWidth;e.right.style.display=900>i?"none":"",t.style.width=i+"px"},resizeRight:function(){var e=this,t=$(".reader-tools-bar").find(".right");centerRightWidth=e.centerRight.offsetWidth+20+"px",width=e.el.offsetWidth-e.asideWidth,900>width||t.css("right",centerRightWidth)},resize:function(){var e=this;m?(s.lang.isFunction(p)||(p=a.debounce(e._resizeFunc,300,e)),p()):(g=!0,e.resizeCenter())},resizeLocation:function(){var e=this,t=$(".doc-reader").height(),i=$(".doc-reader").offset().top,o=+$(window).scrollTop(),r=+$(window).height(),s=+$(".reader-tools-bar-wrap").height(),n=r-(t+i-o);return $(".reader-tools-bar-wrap").find(".reader-fullScreen").hasClass("isFullScreen")?void 0:$(window).width()<1310?void(e.toolsDocBottom&&($(".reader-tools-bar-wrap").css("position","fixed"),$(".reader-tools-bar").css("margin","auto"),e.toolsDocBottom=!1)):void($(".reader-container").width()<960||(n>s&&!e.toolsDocBottom?($("#doc-main").find(".ft").before($(".reader-tools-bar-wrap")),$(".reader-tools-bar-wrap").css("position","relative"),$(".reader-tools-bar").css("margin","0"),e.toolsDocBottom=!0):s>n&&e.toolsDocBottom?($(".reader-tools-bar-wrap").css("position","fixed"),$(".reader-tools-bar").css("margin","auto"),e.toolsDocBottom=!1):$(".reader-tools-bar").css("margin","auto")))},_resizeFunc:function(e){var t=this;if(e=e||{},!l.isFullScreen){if(!m)return void(g=!0);{var i=(s.page.getViewWidth(),e.bodyElWidth||t.bodyEl.offsetWidth);t.asideEl.offsetWidth}970>i-230?($(".reader-tools-bar-wrap").addClass("tools-bar-smaller"),$(".reader-tools-bar").css("width","1124px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0})):$(window).width()>1310&&($(".reader-tools-bar-wrap").removeClass("tools-bar-smaller"),$(".reader-tools-bar").css("width","1200px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0})),t.el.style.overflow="hidden",t.resizeCenter(),t.resizeRight(),t.el.style.overflow="",g=!1}}});i.exports.toolsBar=u});