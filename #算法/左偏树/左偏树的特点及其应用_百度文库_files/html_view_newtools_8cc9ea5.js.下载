require.async(["wkcommon:widget/lib/tangram/base/base.js","wkcommon:widget/lib/fis/data/data.js","wkview:widget/ui/view/down_doc/down_doc.js","wkcommon:widget/ui/js_core/login/login.js","wkcommon:widget/ui/js_core/log/log.js","wkcommon:widget/ui/lib/jquery/jquery.js","wkcommon:widget/ui/lib/store/store.js","wkview:widget/doc_download_main/doc_download_main.js","wkview:widget/html_view/html_reader/js/setting.js"],function(e,o,i,t,a,n,s,c,d){var r,l;e.dom.ready(function(){var s=o;n(window).bind("beforeunload",function(){var e=d.setting.currentPage||1,o={docId:s.get("WkInfo").DocInfo.docId,totalPageNum:s.get("WkInfo").DocInfo.totalPageNum,docFlag:s.get("WkInfo").DocInfo.flag,currentPage:e,duration:(new Date).getTime()-PLAYER_LOAD_START,docType:s.get("WkInfo").DocInfo.docType,player:s.get("WkInfo").DocInfo.player};a.xsend(1,100038,o);for(var i=(new Date).getTime();(new Date).getTime()-i<200;);}),n(".nav-wrap").delegate("a","mousedown",function(){a.xsend(1,100023,{href:encodeURIComponent(n(this).attr("href"))})});n.ajax({url:"/customer/interface/getuserdownloadticket",type:"get",cache:!1,success:function(e){if(0===e.status.code){var o=0,i=0,t=+e.data.isvip;e.data.edu_vip_data&&(o=+e.data.edu_vip_data.is_edu_vip),e.data.jiaoyu_vip_data&&(i=+e.data.jiaoyu_vip_data.is_jiaoyu_vip),r=t||o||i}}}),e.ajax.get("/user/interface/getuserinfo?t="+Math.round((new Date).getTime()/6e3),function(o,i){var t=(e.dom.q("ic",e.dom.q("toolbar-fsm-btn")[0],"span"),i?e.json.parse(i):i);if(t&&0===t.status.code){var a,c,d="string"==typeof t?"":t.data.vipinfo,r="string"==typeof t?"":t.data.edu_vip_info,p="string"==typeof t?"":t.data.jiaoyu_vip_info,f=0,g=0;setTimeout(function(){var o=e.dom.g("tip-notice-new"),i=e.dom.g("vip-msg");if(f=+r.is_vip||0,g=+p.is_vip||0,a=d.type||f||g||0,a?(e.dom.removeClass(i,"vip-msg-hide"),e.dom.addClass(o,"doc-tag"),n("#tip-notice-new").remove(),c=e.dom.g("tip-notice")):(n("#tip-notice-new").css("display","inline-block"),e.lang.eventCenter.dispatchEvent("xreaderResizeRight")),c&&a&&!l){var t='\u7eed\u8d39VIP,\u7acb<span class="five-times">\u8d605\u6b21</span>\u4e0b\u8f7d\u7279\u6743\u8d77';d.type||(n("#vip-msg .ic").addClass("ic-jiaoyu").removeClass("ic-joinvip"),g||(t='\u5347\u7ea7\u5168\u65b0<span class="jiaoyuVip-tip">\u767e\u5ea6\u6559\u80b2VIP</span>\uff0c\u66f4\u591a\u8d44\u6e90\u66f4\u591a\u7279\u6743')),c.innerHTML=t,e.dom.setAttr(c,"href","//yuedu.baidu.com/trade/browse/cashier?type=2&fr=downPop&pos=viewPage_down&ad_logo_type=1&click_type=11011002");var u=s.get("WkInfo").DocInfo.docId,v="/cashier/browse/dispatch?doc_id="+u+"&dqStatCode=31_8_9_11";e.dom.setAttr(c,"href",v)}},1e3)}else n("#tip-notice-new").css("display","inline-block"),e.lang.eventCenter.dispatchEvent("xreaderResizeRight")});var p=o.get("WkInfo"),f=p.DocInfo,g=t.login;if(a.xsend(1,100604),e.cookie.get("BAIDU_DOC_NACT")){if(!e.g("login")){var u=e.cookie.get("BAIDU_DOC_NACT");switch(u){case"download":if(p.UserInfo.isLimit)g.notifyToVerificationMail();else{var v=i.downDocCreate();v.start()}break;case"upload":location.href="/new?fr=login";break;case"cashier":f.vip_type&&0!==f.vip_type||0!==f.edu_vip_type||0!==f.jiaoyu_vip_type||(location.href="/cashier/browse/dispatch?doc_id="+p.DocInfo.docId+"&dqStatCode=31_8_171_174");break;case"addToAlbum":}}e.cookie.remove("BAIDU_DOC_NACT")}var _=location.search;_.indexOf("isbtn")>-1&&c.goSpecialDownload(p),a.send("view","viewload",{cid1:f.cid1,cid2:f.cid2,cid3:f.cid3,cid4:f.cid4,doctype:f.docType,copyright:p.PageInfo.copyright,relatedoc:f.relateDoc,otherlikedoc:f.otherLikeDoc,relatealblum:f.relateAlblum,sameseriesdoc:f.sameSeriesDoc,flag:f.flag,ply:f.readerType,action:"pc_pv"})}),e.dom.ready(function(){var i=o.get("WkInfo"),t=i.PageInfo.isLogin,c=(+i.DocInfo.is_edu_doc,+i.DocInfo.isPaymentDoc,+i.DocInfo.docTicket,+i.DocInfo.hangyebaogao_customized),d=i.DocInfo.org_engName;if(1==c&&(a.xsend(1,100764),"chinairr"==d?a.xsend(1,100793):(d="ibaogao")&&a.xsend(1,100794)),t){var p=e.cookie.get("wk_user_view");p&&e.cookie.set("wk_user_view","",{path:"/",expires:36e5});var f=(new Date).getTime(),g=i.DocInfo.title,u=i.DocInfo.docId,v=i.DocInfo.docType,_=v+":"+u+":"+g+":"+f,w=s.get("wk_user_view")+"",m=s.get("wk_user_view");if(m=m?m.split("###"):[],-1!==w.indexOf(u)||-1!==w.indexOf("undefined"))for(var h=0;h<m.length;h++)if(-1!==(m[h]+"").indexOf(u)||-1!==(m[h]+"").indexOf("undefined")){m.splice(h,1);break}m.push(_),m.length>12&&m.shift(),s.set("wk_user_view",m.join("###"));var y=s.get("wk_user_view_uploaded");if(!y){s.set("wk_user_view_uploaded",1);var I={};for(h=0;h<m.length;h++){var D=m[h].split(":");4===D.length&&(I[D[1]]=D[3].substring(0,10))}n.ajax({url:"/user/interface/jiaoyusession",type:"GET",data:{source:"pc",action:"set",mark:JSON.stringify(I)},timeout:5e3,error:function(){console.log("\u8bf7\u6c42\u51fa\u9519(\u8bf7\u68c0\u67e5\u76f8\u5173\u5ea6\u7f51\u7edc\u72b6\u51b5.)")}})}var u=i.DocInfo.docId,f=Math.floor((new Date).getTime()/1e3);n.ajax({url:"/user/interface/jiaoyusession",type:"GET",data:{source:"pc",action:"set",mark:'{"'+u+'":'+f+"}"},timeout:5e3,error:function(){console.log("\u8bf7\u6c42\u51fa\u9519(\u8bf7\u68c0\u67e5\u76f8\u5173\u5ea6\u7f51\u7edc\u72b6\u51b5.)")}})}n.ajax({type:"get",async:!0,cache:!1,url:"/user/interface/getvipfreedoc?doc_id="+i.DocInfo.docId,success:function(a){var s=!1,c=n("#tip-notice-new"),d=(c.parent(),n(".new-ico-wkmember-free-doc")),p=i.DocInfo.docTicket||0,f=+i.DocInfo.isPaymentDoc||0,g=+i.DocInfo.ispaied||0,u=+i.DocInfo.hangyebaogao_customized||0;a&&0===a.status.code&&(a.data.is_vip_free_doc&&(s=!0,l=!0,s&&(d.show(),n(window).scroll(function(){var e=d.parent(),o=0===n("body").scrollTop()&&n("html").scrollTop()?"html":"body";d.css(n(o).scrollTop()>280&&n(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),n(window).resize(function(){var e=d.parent(),o=0===n("body").scrollTop()&&n("html").scrollTop()?"html":"body";d.css(n(o).scrollTop()>280&&n(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),setTimeout(function(){if(c=n("#tip-notice-new"),c&&0===n("#ppt-wrap").length){if(c.addClass("btn-wkvip"),c.html("<div><p>VIP\u4e13\u4eab</p>\u514d\u8d39\u4e0b\u8f7d</div>"),c.addClass("vip-enjoy"),t){var e=+o.get("isDialogCashier");if(0!==+i.DocInfo.vip_type&&i.DocInfo.vip_type||1!==e){var a="/cashier/browse/dispatch?dqStatCode=31_8_171_174&from_doc="+i.DocInfo.docId;c.attr("href",a)}else;}c.css({visibility:"inherit"});var s=n("#tip-notice"),d=n("#vip-msg");s.html(""),s.addClass("a-new"),s.attr("href","/usera/browse/newvipfreedoczone"),s.addClass("log-xsend"),d.removeClass("vip-msg-hide"),n("#vip-msg .ic").remove(),s.attr("data-logxsend","[1, 100833]")}},800)),o.set("VipFreeDoc",s)),a.data.is_vip_free_doc||setTimeout(function(){r||(c=n("#tip-notice-new"),p||(c.html("<i>\u52a0\u5165VIP</i><br>\u83b7\u53d6\u66f4\u591a\u7279\u6743"),c.css("display","inline-block"),e.lang.eventCenter.dispatchEvent("xreaderResizeRight")),c.css({visibility:"inherit"}))},1e3),g&&u&&f&&setTimeout(function(){var e=n("#tip-notice-new");e.hide()},1200))}})})});